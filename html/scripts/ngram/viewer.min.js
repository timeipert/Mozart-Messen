var missae="rgba(128, 255, 0, 0.1);rgba(200, 255, 0, 0.13);rgba(255, 255, 0, 0.16);rgba(215,209,0,0.2);rgba(255, 109, 0, 0.23);rgba(255, 146, 0, 0.26);rgba(255, 0, 0, 0.3);rgba(255, 105, 180, 0.33);rgba(168, 0, 185, 0.36);rgba(101, 0, 155, 0.4);rgba(72, 0, 255, 0.43);rgba(4, 0, 208, 0.46);rgba(0, 68, 220, 0.5);rgba(1, 114, 226, 0.51);rgba(11, 175, 162, 0.52);rgba(0, 212, 28, 0.53)".split(";"),status=!1;$.extend(!0,$.fn.dataTable.defaults,{searching:!1});
function aHOI(a,l){(resp=a.hasOwnProperty(l));return resp}
$(document).ready(function(){try{$(document).tooltip()}catch(d){$("main").html("Error: Cannot load jquery or jquery ui")}try{fileDistributor.show()}catch(d){$("main").html("Error on fileDistributor")}dialog.dialog("open");cmissae=missae.length;for(var a=1;cmissae>=a;a++){var l=missae[a-1];$("#mislegend").append("<figure><label for='missa"+a+"'>Messe "+a+"</label><div class='legend-color-field' style='background: "+l+"'></div></figure>")}});
var nGramViewer=function(){function a(a,e,f){$("main").html('<div id="starter"><div class="sk-folding-cube"> <div class="sk-cube1 sk-cube"></div> <div class="sk-cube2 sk-cube"></div> <div class="sk-cube4 sk-cube"></div> <div class="sk-cube3 sk-cube"></div> </div></div>');$("main").load(a,function(){var a=$("main").html().match(/\x3c!--HEADER\|([\w\s]+)\|([\w\s]+)\|([\w\s]+)\|([\w\s]+)|([\w\s]*)--\x3e/i);if(a){var b=a[1],p=a[2];m=a[4];$(".subtitle").html(b+" - "+p)}else m=100;d(e,f);$("table").DataTable({order:[[1,
    "desc"]],drawCallback:function(a){$("table tbody tr").each(function(a){$(this).children().last().html().match(/(\d)+:(\d)+/)&&positionViewer.build($(this).children().last().find("ul"),a,500,m);var b=$(this).children().first().text();if(b.match(/\|/)){var f=b.split(": "),d=f[1].split("|"),e="<div style='display:none;' id='sc"+a+"'>",g=c[f[0]],e=e+(h[g]+" ");d.forEach(function(a){g+=parseInt(a);e+=h[g.toString()]+" "});e+="</div>";$(this).children().first().html(e);l(this,b)}})},initComplete:function(a, b){nGramViewer.setLegend();console.log("initComplete")}})})}function l(a,e){var f=$(a).children().first();f.append('<canvas width="500" height="80" title="'+e+'"></canvas>');var g=$(a).find("canvas")[0],g=(new Vex.Flow.Renderer(g,Vex.Flow.Renderer.Backends.CANVAS)).getContext();g.scale(.7,.7);var b=new Vex.Flow.Stave(0,0,500);b.addClef("treble");b.setContext(g).draw();var d=[],f=f.text().split(" ");if("undefined"==f[0])return!1;for(noteKey in f)if(aHOI(f,noteKey)){var c=f[noteKey];""!=c&&(c.match(/#/)?
    d.push((new Vex.Flow.StaveNote({clef:"treble",keys:[c],duration:"q"})).addAccidental(0,new Vex.Flow.Accidental("#"))):c.match(/\Db/)?d.push((new Vex.Flow.StaveNote({clef:"treble",keys:[c],duration:"q"})).addAccidental(0,new Vex.Flow.Accidental("b"))):d.push(new Vex.Flow.StaveNote({clef:"treble",keys:[c],duration:"q"})))}Vex.Flow.Formatter.FormatAndDraw(g,b,d)}function d(c,d){var f=$("#ngram-select");f.html("");for(var e=0;e<c.length;e++){var b=c[e],h="";b==d&&(h="selected='selected'");f.append("<option id='"+
    b+"' "+h+">"+b+"</option>")}f.on("change",function(b,d){a(fileDistributor.getFilePrototype($(this).val()),c,$(this).val())})}var m=0,h={"-12":"c/3","-11":"c#/3","-10":"d/3","-9":"eb/3","-8":"e/3","-7":"f/3","-6":"f#/3","-5":"g/3","-4":"ab/3","-3":"a/3","-2":"bb/3","-1":"b/3",0:"c/4",1:"c#/4",2:"d/4",3:"eb/4",4:"e/4",5:"f/4",6:"f#/4",7:"g/4",8:"ab/4",9:"a/4",10:"bb/4",11:"b/4",12:"c/5",13:"c#/5",14:"d/5",15:"eb/5",16:"e/5",17:"f/5",18:"f#/5",19:"g/5",20:"ab/5",21:"a/5",22:"bb/5",23:"b/5",24:"c/6",
    25:"c#/6",26:"d/6",27:"eb/6",28:"e/6",29:"f/6",30:"f#/6",31:"g/6",32:"ab/6",33:"a/6"},c={C:12,"C#":13,D:14,"D#":15,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,"B-":10,B:11};return{setLegend:function(){console.log("setLegend");switch(status){case "false":$("#movlegend").hide();console.log(!1);$("#mislegend").hide();break;case "mis":$("#mislegend").show();console.log("mis");$("#movlegend").hide();break;case "mov":$("#movlegend").show(),console.log("mov"),$("#mislegend").hide()}},drawViewer:a}}();
Array.prototype.unique=function(){var a=[],l=0;a:for(;l<this.length;l++){for(var d=0;d<a.length;d++)if(a[d]==this[l])continue a;a[a.length]=this[l]}return a};
var positionViewer=function(){return{build:function(a,l,d,m){var h=a.html(),c=h.match(/(\d)+:(\d)+( \([a-z]+\))?(\(\d+\))?/g),h=h.match(/(\d)+:(\d)+/g);c.sort(function(a,b){var c=a.split(" ")[0],d=b.split(" ")[0];return c.split(":")[0]-d.split(":")[0]});var r=c.join(" - ");a.parent().html('<div  id="canvas'+l+"\" class='measureline'></div>");a=new Raphael(document.getElementById("canvas"+l),d,20);a.path("M0 20L"+d+" 20");for(var e=1;19>=e;e++){var f=d/20*e;a.path("M"+f+" 20L"+f+" 16").attr({"stroke-opacity":.5,
    "stroke-size":.6})}a.path("M0 20L0 15").attr({"stroke-size":1.2});a.path("M"+d+" 20L"+d+" 15").attr({"stroke-size":1.2});var f={"(ad)":"#9999e9","(k)":"#b7e6e6","(c)":"#99e699","(b)":"#E9D5A1","(g)":"#999999","(s)":"#E99999"},g="";for(k in h)if(aHOI(h,k)){var b=h[k];b=b.split(":");parseInt(b[1])>g&&(g=parseInt(b[1]));m<g&&(m=g,console.log("Measures:"+m))}for(e in h)if(aHOI(h,e)){b=h[e];var p=c[e].split(" "),q="";p[1]in f?(q=f[p[1]],status="mov"):(q="#000000",status="false");if(p=c[e].match(/\(([a-z]+\))\((\d+)\)/))q=
    missae[p[2]],status="mis";b=b.split(":");parseInt(b[1])>g&&(g=parseInt(b[1]));m<g&&(m=g);b[0]*=d/m;b[1]*=d/m;a.rect(b[0],0,b[1]-b[0]+3,20).attr({"stroke-width":0,fill:q,"fill-opacity":.4})}$("#canvas"+l).attr("title",r+" ("+m+")")}}}(),fileDistributor=function(){function a(){dialog=$("#dist-dialog").dialog({autoOpen:!1,height:400,width:350,modal:!0,buttons:{Select:function(){nGramViewer.drawViewer("data/"+d+".html",m[d],5);$(".menu").hide();dialog.dialog("close")}},close:function(){dialog.dialog("close");
    $(".menu").hide()}});$("#open-dist").button().on("click",function(){dialog.dialog("open");$(".menu").show()})}var l={complet:"Alle Messen",ad:"Agnus Dei",k:"Kyrie",c:"Credo",b:"Benedictus",g:"Gloria",s:"Sanctus",m:"Ganze Messe"},d,m={};return{show:function(){a();$.getJSON("data/dict.json",function(a){var c="<ul>";for(k in a)if(aHOI(a,k)){var h=a[k],c=c+("<li data-jstree='{\"disabled\":true}'>Missa Nr."+k+"<ul>"),e;for(e in h)if(aHOI(h,e)){var f=h[e],g="m"+k+"/"+e,c=c+("<li data-jstree='{\"disabled\":true}'>"+
    l[e]+"<ul>");for(n in f)if(aHOI(f,n)){var b=f[n],p=g+b,c=c+("<li id='"+p+"'>"+b+"</li>");m[p]=f}c+="</ul></li>"}c+="</ul></li>"}c+="</ul>";$("#jstree").html(c);$("#jstree").on("changed.jstree",function(a,b){d=b.selected[0]}).jstree()})},getInfo:function(){var a={};$.getJSON("data/dict.json",function(c){for(k in c)if(aHOI(c,k))for(movements in a[k]={},c[k])a[k][movements]=c[k][movements]});return a},getFilePrototype:function(a){return"data/"+(d+".html").match(/(.*?)(\d)+\.html/i)[1]+a+".html"}}}();